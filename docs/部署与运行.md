### 部署与运行（整合自 README）

本文档汇总项目的本地运行与基础部署步骤，整合自 `README.md`，并加入与样式构建相关的说明。若与 README 存在差异，以两者较新的版本为准。

---

## 1. 环境与依赖

### 1.1 Python 依赖
```bash
pip install -r requirements.txt
```

### 1.2 Node 工具（用于样式构建，可选但推荐）
- 如需本地编译 SCSS → CSS 与自动加前缀：安装 Node.js LTS
- 按《工具链配置说明》安装 `sass`, `postcss`, `autoprefixer`, `cssnano` 等

---

## 2. 初始化 instance
需创建 `instance` 目录，结构示例：
```
instance
├── avatars
├── database
├── stories
│   ├── mainstories_batch1
│   │   ├── info.json
│   │   ├── teststory1.md
│   │   └── teststory2.md
│   ├── mainstories_batch2
│   │   ├── info.json
│   │   ├── teststory3.md
│   │   └── teststory4.md
│   └── mainstories_batch3
│       ├── info.json
│       ├── teststory5.md
│       └── teststory6.md
└── blogs
```

可手动创建，或运行下面命令自动创建四个基础文件夹：
```bash
python check_instance.py
```

### 2.1 stories
- `instance/stories/*/info.json` 示例：
```json
{
  "title": "其它小说",
  "name": "转载/代发",
  "details": "聪明山朋友的原创故事。",
  "description": "在这里阅读转载的精彩小说",
  "ignore": false,
  "priority": 30
}
```
- `priority` 越大越靠前；`ignore: true` 则不显示
- Markdown 文件需有 YAML 头（详见 README）

### 2.2 blogs 与 avatars
- 运行期会自动生成：
  - 注册用户的默认头像会生成到 `instance/avatars`
  - 文章数据在 `instance/database/db.db`（同时会在 `instance/blogs` 下建空目录）

### 2.3 database
首次运行需初始化数据库：
```bash
flask db init
flask db upgrade
```
生成 `instance/database/db.db`。

---

## 3. 配置文件（.env）
在项目根目录创建 `.env`，示例：
```
SQLALCHEMY_DATABASE_URI=sqlite:///../instance/database/db.db
SECRET_KEY=请替换为强随机字符串
DEBUG=True
TURNSTILE_SITE_KEY=your_site_key
TURNSTILE_SECRET_KEY=your_secret_key
TURNSTILE_AVAILABLE=False
CONFIG_TYPE=development
```

---

## 4. 启动应用
```bash
python run.py
```

管理后台相关：
```bash
flask promote-admin <username>
```
将指定用户设为管理员。用户管理界面：`/auth/user_management`

---

## 5. 样式构建（SCSS → CSS）
详见《工具链配置说明》。常用命令：

开发（watch）：
```bash
sass --style=expanded --source-map static/scss/main.scss static/css/main.css --load-path=static/scss --watch
```

生产（编译 + 前缀 + 压缩）：
```bash
sass --style=expanded static/scss/main.scss static/css/main.css --no-source-map --load-path=static/scss
postcss static/css/main.css --use autoprefixer --no-map | postcss --use cssnano --no-map > static/css/main.min.css
```

模板引用建议：
- 开发：仅引用 `static/css/main.css`
- 生产：仅引用 `static/css/main.min.css`

---

## 6. 访问与测试
- 访问主页：`/`
- 联系页：`/contact`
- 登录注册：`/auth/login`、`/auth/register`
- 通知：`/notifications/`
- 博客：`/blog/`

---

## 7. 注意事项
- 本重构不处理 `static/css/quandi` 与 `static/css/xingkong`（后续下线）
- 若选择完全移除 Bootstrap：删除模板中 Bootstrap 引用，用自研布局与组件替代
- 若选择本地化 Bootstrap（过渡）：将文件放置 `static/vendor/bootstrap/` 并改为本地 `<link>`，同时逐步迁移到自研样式


