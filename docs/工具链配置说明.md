### 工具链配置说明（Sass + PostCSS）

本文档描述如何在本项目引入并使用 Sass 与 PostCSS 的标准构建链路，用于编译 SCSS → CSS、自动补全浏览器前缀与压缩产物。当前文档仅为配置说明，不对代码进行改动。

---

## 目标
- 使用 Dart Sass 编译 SCSS 源码到 CSS
- 使用 PostCSS 在生产环境执行 Autoprefixer 与压缩（cssnano）
- 区分开发与生产产物：开发 `static/css/main.css`（含 SourceMap），生产 `static/css/main.min.css`
- 后续可扩展：Stylelint、内容裁剪（谨慎启用）、主题等

## 目录约定
- 源码目录：`static/scss/`
- 产物目录：`static/css/`
- 入口文件：`static/scss/main.scss`
- 供应商样式：`static/css/vendors/` 或 `static/scss/vendors/`（是否需定制决定位置）

## 工具与依赖（建议）
- Node.js LTS（本地开发工具）
- npm 包：
  - `sass`（Dart Sass，SCSS → CSS 编译）
  - `postcss`（CSS 后处理管线）
  - `autoprefixer`（自动添加浏览器前缀）
  - `cssnano`（生产环境压缩）
  - 可选：`postcss-cli`（命令行驱动 PostCSS）
  - 可选：`stylelint`、`stylelint-config-standard-scss`、`stylelint-config-prettier`（规范与校验）

## 浏览器目标
通过 Browserslist 统一声明目标浏览器（PostCSS/Autoprefixer 读取）：
```
> 0.5%
last 2 versions
not dead
```

## 命令与流程（建议脚本）

开发（生成未压缩 CSS + SourceMap）：
```
sass --style=expanded --source-map static/scss/main.scss static/css/main.css --load-path=static/scss --watch
```

生产（编译 + 后处理压缩）：
```
# 1) Sass 编译（无 map，体积小）
sass --style=expanded static/scss/main.scss static/css/main.css --no-source-map --load-path=static/scss

# 2) PostCSS 执行 autoprefixer + cssnano，输出 min 版
postcss static/css/main.css --use autoprefixer --no-map | postcss --use cssnano --no-map > static/css/main.min.css
```

说明：
- 开发环境建议仅跑 Sass `--watch`，提升迭代速度；生产再跑 PostCSS。
- `--load-path=static/scss` 允许在 SCSS 中使用简化的 `@use`/`@forward` 路径。

## PostCSS 配置（建议）
创建 `postcss.config.js`（位置：项目根目录）：
```
module.exports = (ctx) => ({
  map: false,
  plugins: {
    autoprefixer: {},
    // 仅在生产环境启用压缩
    ...(ctx.env === 'production' ? { cssnano: { preset: 'default' } } : {}),
  },
});
```

或使用 CLI 显式传入 `--use` 插件（如上命令所示）。

## Stylelint（可选但推荐）
规则目标：
- BEM 命名建议（可在团队规范中约定，不强制 lint）
- 限制嵌套深度（≤ 2 层）
- 禁止 `!important`（或设白名单）
- 禁止无用选择器与重复属性

示例依赖：`stylelint stylelint-config-standard-scss stylelint-config-prettier`

示例配置 `stylelint.config.cjs`：
```
module.exports = {
  extends: ['stylelint-config-standard-scss', 'stylelint-config-prettier'],
  rules: {
    'max-nesting-depth': 2,
    'declaration-no-important': true,
  },
};
```

## 模板引用策略
- 开发：模板引用 `static/css/main.css`
- 生产：模板引用 `static/css/main.min.css`
- 第三方样式（如 Pygments）独立 `<link>`，或在我们样式之后少量覆写（位于 `vendors/`）

## 与 Bootstrap 的关系
- 完全移除：不在 SCSS 中引入 Bootstrap，使用自研 `layout/components`
- 过渡期本地化：将 Bootstrap 置于 `static/vendor/bootstrap/`，模板 `<link>` 改为本地，并在其后引入我们的 `main.css`，逐步替换后移除

## 常见问题
- 路径与换行：Windows PowerShell 下建议使用正斜杠路径；长命令可用 npm script 包装
- SourceMap：仅在开发启用；生产关闭以减小体积
- Purge/内容裁剪：容易误删动态类，建议在完成迁移并建立 safelist 后再考虑


