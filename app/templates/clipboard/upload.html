{% extends "base.html" %}
{% block title %}
{% if clip %}
{{clip.title}} 文章编辑 - Raricy.com
{% else %}
上传云剪贴板 - Raricy.com
{% endif %}
{% endblock %}

{% block extra_css %}
{% endblock %}

{% block content %}
<div class="clipboard-page">
    <h1 class="clipboard-title">
        {% if clip %}
        {{clip.title}} 文章编辑
        {% else %}
        上传云剪贴板
        {% endif %}
    </h1>
    
    <div class="clipboard-form">
        <form id="uploadForm">
            <div class="clipboard-form__group">
                <label for="title">标题</label>
                <input type="text" id="title" name="title" value="{{ clip.title if clip else '' }}" placeholder="请输入标题" required>
            </div>
            
            <div class="clipboard-form__group">
                <label for="content">正文</label>
                <textarea id="content" name="content" placeholder="请输入正文内容" rows="15">{{ clip.content if clip else ''}}</textarea>
            </div>
            
            <div class="clipboard-form__group clipboard-form__group--checkbox">
                <input type="checkbox" id="publicity" name="publicity" {% if not clip or clip.publicity %}checked{% endif %}>
                <label for="publicity">是否公开</label>
            </div>
            
            <button type="submit" class="clipboard-form__submit">
                {% if clip %}更新{% else %}提交{% endif %}
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const data = {
                title: form.title.value,
                content: form.content.value,
                publicity: form.publicity.checked
            };
            try{
                    const response = await fetch(window.location.pathname, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                })
                if (response.ok){
                    const result = await response.json();
                    console.log('成功');
                    window.location.href = `/clipboard/${result.id}`
                } else {
                    const result = await response.json();
                    alert(`上传失败，原因：${result.message}`)
                }
            }catch(error){
                console.log(error);
                alert('出错了qaq，快去找raricy')
            }
        })
    })
</script>
{% endblock %}

{% block footer_text %}
{% endblock %}
