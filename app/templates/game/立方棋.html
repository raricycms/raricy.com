<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4Ã—4Ã—4ç«‹æ–¹ä½“ä¸‹æ£‹</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            height: 100dvh;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: Arial, sans-serif;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            perspective: 1200px;
            perspective-origin: center center;
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
        }

        .cube-system {
            position: relative;
            transform-style: preserve-3d;
            cursor: grab;
            transform-origin: center center;
            touch-action: none;
        }

        .cube-system:active {
            cursor: grabbing;
        }

        .small-cube {
            position: absolute;
            width: 50px;
            height: 50px;
            transform-style: preserve-3d;
            transition: transform 0.5s ease-in-out;
            cursor: pointer;
        }

        .face {
            position: absolute;
            width: 50px;
            height: 50px;
            border: 1px solid #333;
            background: rgba(255, 255, 255, 0.8);
            transition: background-color 0.2s ease;
        }

        .face.front { transform: translateZ(25px); }
        .face.back { transform: translateZ(-25px) rotateY(180deg); }
        .face.right { transform: rotateY(90deg) translateZ(25px); }
        .face.left { transform: rotateY(-90deg) translateZ(25px); }
        .face.top { transform: rotateX(90deg) translateZ(25px); }
        .face.bottom { transform: rotateX(-90deg) translateZ(25px); }

        /* é«˜äº®çŠ¶æ€ */
        .small-cube.highlight .face {
            background: rgba(255, 255, 0, 0.6);
        }

        /* çº¢æ–¹ */
        .small-cube.red .face {
            background: rgba(255, 100, 100, 0.8);
        }

        /* è“æ–¹ */
        .small-cube.blue .face {
            background: rgba(100, 100, 255, 0.8);
        }

        /* è·èƒœè¿çº¿é«˜äº® */
        .small-cube.winning .face {
            background: rgba(255, 215, 0, 0.9) !important;
            border: 3px solid #FFD700 !important;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        /* æœ€åä¸€æ­¥é«˜äº® - è°ƒæ•´ä¸ºæ›´æŸ”å’Œçš„ç»¿è‰² */
        .small-cube.last-move .face {
            border: 2px solid #4CAF50 !important;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.4);
        }

        /* æ¸¸æˆä¿¡æ¯ */
        .game-info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
        }

        .current-player {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .winner-message {
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
        }

        .draw-message {
            font-size: 18px;
            font-weight: bold;
            color: #FFA500;
            margin-bottom: 10px;
        }

        .button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px 5px 0 0;
            font-size: 12px;
        }

        .button:hover {
            background: #45a049;
        }

        .button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .undo-button {
            background: #ff9800;
        }

        .undo-button:hover {
            background: #e68900;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1000;
        }

        @media (max-width: 600px) {
            .game-info, .controls {
                font-size: 12px;
                padding: 10px;
            }
            .current-player {
                font-size: 14px;
            }
            .winner-message, .draw-message {
                font-size: 16px;
            }
            .button {
                padding: 10px 14px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="game-info">
        <div class="winner-message" id="winnerMessage" style="display: none;"></div>
        <div class="draw-message" id="drawMessage" style="display: none;"></div>
        <div class="current-player" id="currentPlayer">å½“å‰ç©å®¶: çº¢æ–¹</div>
        <div>çº¢æ–¹æ£‹å­: <span id="redCount">0</span></div>
        <div>è“æ–¹æ£‹å­: <span id="blueCount">0</span></div>
        <div>æ€»æ­¥æ•°: <span id="totalMoves">0</span> / 64</div>
        <div style="margin-top: 10px;">
            <button class="button undo-button" id="undoButton" onclick="undoMove()" disabled>æ‚”æ£‹</button>
            <button class="button" onclick="resetGame()">é‡æ–°å¼€å§‹</button>
        </div>
    </div>

    <div class="controls">
        <div>æ“ä½œè¯´æ˜:</div>
        <div>â€¢ æ‹–æ‹½/æ»‘åŠ¨æ—‹è½¬è§†è§’</div>
        <div>â€¢ ç‚¹å‡»/è½»è§¦ä¸‹æ£‹</div>
        <div>â€¢ A/S/Dé”®çˆ†ç‚¸è§†å›¾</div>
        <div>â€¢ å››å­è¿çº¿è·èƒœ</div>
        <div>â€¢ ç»¿æ¡†æ˜¾ç¤ºæœ€åä¸€æ­¥</div>
        <div>â€¢ 64æ­¥æ— èƒœè´Ÿä¸ºå¹³å±€</div>
    </div>

    <div class="container" id="container">
        <div class="cube-system" id="cubeSystem">
        </div>
    </div>

    <script>
        const container = document.getElementById('container');
        const cubeSystem = document.getElementById('cubeSystem');
        const currentPlayerEl = document.getElementById('currentPlayer');
        const winnerMessageEl = document.getElementById('winnerMessage');
        const drawMessageEl = document.getElementById('drawMessage');
        const redCountEl = document.getElementById('redCount');
        const blueCountEl = document.getElementById('blueCount');
        const totalMovesEl = document.getElementById('totalMoves');
        const undoButtonEl = document.getElementById('undoButton');
        
        let cubes = [];
        let cubeGrid = {}; // ç”¨äºå¿«é€ŸæŸ¥æ‰¾ç«‹æ–¹ä½“
        let isMouseDown = false;
        let mouseX = 0;
        let mouseY = 0;
        let rotationX = -15;
        let rotationY = 25;
        let currentRotationX = 0;
        let currentRotationY = 0;
        let scaleFactor = 1;

        // æ¸¸æˆçŠ¶æ€
        let currentPlayer = 'red'; // 'red' æˆ– 'blue'
        let redCount = 0;
        let blueCount = 0;
        let totalMoves = 0;
        let gameEnded = false;
        let moveHistory = []; // å­˜å‚¨å†å²æ­¥éª¤

        // çˆ†ç‚¸çŠ¶æ€
        let explodeState = {
            x: false,
            y: false,
            z: false
        };

        // æ‰€æœ‰å¯èƒ½çš„è¿çº¿æ–¹å‘ï¼ˆ76ç§ï¼‰
        const winDirections = [
            // Xè½´æ–¹å‘ï¼ˆ16æ¡çº¿ï¼‰
            [1, 0, 0],
            // Yè½´æ–¹å‘ï¼ˆ16æ¡çº¿ï¼‰
            [0, 1, 0],
            // Zè½´æ–¹å‘ï¼ˆ16æ¡çº¿ï¼‰
            [0, 0, 1],
            // XYå¹³é¢å¯¹è§’çº¿ï¼ˆ8æ¡çº¿ï¼‰
            [1, 1, 0], [1, -1, 0],
            // XZå¹³é¢å¯¹è§’çº¿ï¼ˆ8æ¡çº¿ï¼‰
            [1, 0, 1], [1, 0, -1],
            // YZå¹³é¢å¯¹è§’çº¿ï¼ˆ8æ¡çº¿ï¼‰
            [0, 1, 1], [0, 1, -1],
            // ä½“å¯¹è§’çº¿ï¼ˆ4æ¡çº¿ï¼‰
            [1, 1, 1], [1, 1, -1], [1, -1, 1], [-1, 1, 1]
        ];

        // åˆ›å»º64ä¸ªå°ç«‹æ–¹ä½“
        function createCubes() {
            cubes = [];
            cubeGrid = {};
            
            for (let x = 0; x < 4; x++) {
                for (let y = 0; y < 4; y++) {
                    for (let z = 0; z < 4; z++) {
                        const cube = document.createElement('div');
                        cube.className = 'small-cube';
                        
                        // åŸºç¡€ä½ç½®ï¼ˆç›¸å¯¹äºä¸­å¿ƒï¼‰
                        const baseX = (x - 1.5) * 60;
                        const baseY = (y - 1.5) * 60;
                        const baseZ = (z - 1.5) * 60;
                        
                        // å­˜å‚¨ä½ç½®ä¿¡æ¯
                        cube.dataset.x = x;
                        cube.dataset.y = y;
                        cube.dataset.z = z;
                        cube.dataset.baseX = baseX;
                        cube.dataset.baseY = baseY;
                        cube.dataset.baseZ = baseZ;
                        cube.dataset.occupied = 'false';
                        cube.dataset.player = '';
                        
                        // åˆ›å»º6ä¸ªé¢
                        const faces = ['front', 'back', 'right', 'left', 'top', 'bottom'];
                        faces.forEach(faceName => {
                            const face = document.createElement('div');
                            face.className = `face ${faceName}`;
                            cube.appendChild(face);
                        });
                        
                        // æ·»åŠ é¼ æ ‡äº‹ä»¶
                        cube.addEventListener('mouseenter', handleMouseEnter);
                        cube.addEventListener('mouseleave', handleMouseLeave);
                        cube.addEventListener('click', handleClick);
                        // è§¦æ‘¸è½»ç‚¹ä¸‹æ£‹ï¼ˆé˜»æ­¢å†’æ³¡ï¼Œé¿å…è§¦å‘æ—‹è½¬ï¼‰
                        cube.addEventListener('touchstart', cubeTouchStart, { passive: false });
                        cube.addEventListener('touchmove', cubeTouchMove, { passive: false });
                        cube.addEventListener('touchend', cubeTouchEnd);
                        
                        cubeSystem.appendChild(cube);
                        cubes.push(cube);
                        
                        // å»ºç«‹åæ ‡ç´¢å¼•
                        cubeGrid[`${x},${y},${z}`] = cube;
                    }
                }
            }
            updateCubePositions();
        }

        // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
        function checkWin(player) {
            // éå†æ‰€æœ‰å¯èƒ½çš„èµ·å§‹ç‚¹
            for (let x = 0; x < 4; x++) {
                for (let y = 0; y < 4; y++) {
                    for (let z = 0; z < 4; z++) {
                        // æ£€æŸ¥æ¯ä¸ªæ–¹å‘
                        for (const [dx, dy, dz] of winDirections) {
                            const line = [];
                            let valid = true;
                            
                            // æ£€æŸ¥è¿™ä¸ªæ–¹å‘çš„4ä¸ªè¿ç»­ä½ç½®
                            for (let i = 0; i < 4; i++) {
                                const nx = x + dx * i;
                                const ny = y + dy * i;
                                const nz = z + dz * i;
                                
                                // æ£€æŸ¥åæ ‡æ˜¯å¦åœ¨èŒƒå›´å†…
                                if (nx < 0 || nx >= 4 || ny < 0 || ny >= 4 || nz < 0 || nz >= 4) {
                                    valid = false;
                                    break;
                                }
                                
                                const cube = cubeGrid[`${nx},${ny},${nz}`];
                                if (!cube || cube.dataset.player !== player) {
                                    valid = false;
                                    break;
                                }
                                
                                line.push(cube);
                            }
                            
                            // å¦‚æœæ‰¾åˆ°äº†4ä¸ªè¿ç»­çš„åŒè‰²æ£‹å­
                            if (valid && line.length === 4) {
                                return line;
                            }
                        }
                    }
                }
            }
            return null;
        }

        // æ£€æŸ¥æ˜¯å¦å¹³å±€
        function checkDraw() {
            return totalMoves >= 64;
        }

        // é«˜äº®è·èƒœè¿çº¿
        function highlightWinningLine(line) {
            line.forEach(cube => {
                cube.classList.add('winning');
            });
        }

        // æ˜¾ç¤ºèƒœåˆ©ä¿¡æ¯
        function showWinner(player) {
            gameEnded = true;
            const playerName = player === 'red' ? 'çº¢æ–¹' : 'è“æ–¹';
            winnerMessageEl.textContent = `ğŸ‰ ${playerName}è·èƒœï¼`;
            winnerMessageEl.style.display = 'block';
            drawMessageEl.style.display = 'none';
            currentPlayerEl.style.display = 'none';
        }

        // æ˜¾ç¤ºå¹³å±€ä¿¡æ¯
        function showDraw() {
            gameEnded = true;
            drawMessageEl.textContent = 'ğŸ¤ å¹³å±€ï¼';
            drawMessageEl.style.display = 'block';
            winnerMessageEl.style.display = 'none';
            currentPlayerEl.style.display = 'none';
        }

        // æ›´æ–°UIæ˜¾ç¤º
        function updateUI() {
            redCountEl.textContent = redCount;
            blueCountEl.textContent = blueCount;
            totalMovesEl.textContent = totalMoves;
            undoButtonEl.disabled = moveHistory.length === 0 || gameEnded;
            
            if (!gameEnded) {
                currentPlayerEl.textContent = `å½“å‰ç©å®¶: ${currentPlayer === 'red' ? 'çº¢æ–¹' : 'è“æ–¹'}`;
            }
        }

        // æ¸…é™¤æœ€åä¸€æ­¥é«˜äº®
        function clearLastMoveHighlight() {
            cubes.forEach(cube => {
                cube.classList.remove('last-move');
            });
        }

        // æ‚”æ£‹åŠŸèƒ½
        function undoMove() {
            if (moveHistory.length === 0 || gameEnded) {
                return;
            }

            const lastMove = moveHistory.pop();
            const cube = cubeGrid[`${lastMove.x},${lastMove.y},${lastMove.z}`];
            
            // æ¢å¤ç«‹æ–¹ä½“çŠ¶æ€
            cube.dataset.occupied = 'false';
            cube.dataset.player = '';
            cube.className = 'small-cube';
            
            // æ›´æ–°è®¡æ•°
            if (lastMove.player === 'red') {
                redCount--;
            } else {
                blueCount--;
            }
            totalMoves--;
            
            // åˆ‡æ¢å›ä¸Šä¸€ä¸ªç©å®¶
            currentPlayer = lastMove.player;
            
            // æ¸…é™¤æ‰€æœ‰é«˜äº®
            clearLastMoveHighlight();
            cubes.forEach(cube => {
                cube.classList.remove('winning');
            });
            
            // é«˜äº®æ–°çš„æœ€åä¸€æ­¥ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            if (moveHistory.length > 0) {
                const newLastMove = moveHistory[moveHistory.length - 1];
                const newLastCube = cubeGrid[`${newLastMove.x},${newLastMove.y},${newLastMove.z}`];
                newLastCube.classList.add('last-move');
            }
            
            updateUI();
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            gameEnded = false;
            currentPlayer = 'red';
            redCount = 0;
            blueCount = 0;
            totalMoves = 0;
            moveHistory = [];
            
            // æ¸…é™¤æ‰€æœ‰ç«‹æ–¹ä½“çŠ¶æ€
            cubes.forEach(cube => {
                cube.dataset.occupied = 'false';
                cube.dataset.player = '';
                cube.className = 'small-cube';
            });
            
            // é‡ç½®UI
            winnerMessageEl.style.display = 'none';
            drawMessageEl.style.display = 'none';
            currentPlayerEl.style.display = 'block';
            updateUI();
        }

        // é¼ æ ‡è¿›å…¥ç«‹æ–¹ä½“
        function handleMouseEnter(e) {
            if (gameEnded) return;
            const cube = e.currentTarget;
            if (cube.dataset.occupied === 'false') {
                cube.classList.add('highlight');
            }
        }

        // é¼ æ ‡ç¦»å¼€ç«‹æ–¹ä½“
        function handleMouseLeave(e) {
            const cube = e.currentTarget;
            cube.classList.remove('highlight');
        }

        // ç‚¹å‡»ç«‹æ–¹ä½“ï¼ˆæ”¹ä¸ºå•å‡»ä¸‹æ£‹ï¼‰
        function handleClick(e) {
            if (gameEnded) return;
            e.stopPropagation();
            const cube = e.currentTarget;
            
            // å¦‚æœå·²ç»è¢«å ç”¨ï¼Œä¸èƒ½ç‚¹å‡»
            if (cube.dataset.occupied === 'true') {
                return;
            }

            // å•å‡»ä¸‹æ£‹
            placePiece(cube);
        }

        // è§¦æ‘¸è½»ç‚¹å¤„ç†ï¼ˆåœ¨å°ç«‹æ–¹ä½“ä¸Šï¼‰
        function cubeTouchStart(e) {
            if (gameEnded) return;
            e.stopPropagation();
            // æ ‡è®°æœ¬æ¬¡è§¦æ‘¸èµ·ç‚¹ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦æ»‘åŠ¨
            const touch = e.touches[0];
            const cube = e.currentTarget;
            cube._touchStartX = touch.clientX;
            cube._touchStartY = touch.clientY;
            cube._touchMoved = false;
            e.preventDefault();
        }

        function cubeTouchMove(e) {
            const cube = e.currentTarget;
            if (cube._touchStartX == null) return;
            const touch = e.touches[0];
            const dx = Math.abs(touch.clientX - cube._touchStartX);
            const dy = Math.abs(touch.clientY - cube._touchStartY);
            if (dx > 10 || dy > 10) {
                cube._touchMoved = true;
            }
            e.preventDefault();
        }

        function cubeTouchEnd(e) {
            if (gameEnded) return;
            e.stopPropagation();
            const cube = e.currentTarget;
            if (!cube._touchMoved && cube.dataset.occupied === 'false') {
                placePiece(cube);
            }
            cube._touchStartX = null;
            cube._touchStartY = null;
            cube._touchMoved = false;
            e.preventDefault();
        }

        // ä¸‹æ£‹é€»è¾‘
        function placePiece(cube) {
            if (gameEnded || cube.dataset.occupied === 'true') {
                return;
            }

            // è®°å½•è¿™ä¸€æ­¥
            const move = {
                x: parseInt(cube.dataset.x),
                y: parseInt(cube.dataset.y),
                z: parseInt(cube.dataset.z),
                player: currentPlayer
            };
            moveHistory.push(move);

            // æ¸…é™¤ä¹‹å‰çš„æœ€åä¸€æ­¥é«˜äº®
            clearLastMoveHighlight();

            // ä¸‹æ£‹
            cube.dataset.occupied = 'true';
            cube.dataset.player = currentPlayer;
            cube.classList.remove('highlight');
            cube.classList.add(currentPlayer);
            cube.classList.add('last-move'); // æ ‡è®°ä¸ºæœ€åä¸€æ­¥

            // æ›´æ–°è®¡æ•°
            if (currentPlayer === 'red') {
                redCount++;
            } else {
                blueCount++;
            }
            totalMoves++;

            // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
            const winningLine = checkWin(currentPlayer);
            if (winningLine) {
                highlightWinningLine(winningLine);
                showWinner(currentPlayer);
                updateUI();
                return;
            }

            // æ£€æŸ¥å¹³å±€
            if (checkDraw()) {
                showDraw();
                updateUI();
                return;
            }

            // åˆ‡æ¢ç©å®¶
            currentPlayer = currentPlayer === 'red' ? 'blue' : 'red';
            updateUI();
        }

        // æ›´æ–°ç«‹æ–¹ä½“ä½ç½®
        function updateCubePositions() {
            cubes.forEach(cube => {
                const x = parseInt(cube.dataset.x);
                const y = parseInt(cube.dataset.y);
                const z = parseInt(cube.dataset.z);
                const baseX = parseFloat(cube.dataset.baseX);
                const baseY = parseFloat(cube.dataset.baseY);
                const baseZ = parseFloat(cube.dataset.baseZ);
                
                let offsetX = 0;
                let offsetY = 0;
                let offsetZ = 0;
                
                // è®¡ç®—çˆ†ç‚¸åç§»ï¼ˆ60pxï¼‰
                if (explodeState.x) {
                    offsetX = (x - 1.5) * 60;
                }
                if (explodeState.y) {
                    offsetY = (y - 1.5) * 60;
                }
                if (explodeState.z) {
                    offsetZ = (z - 1.5) * 60;
                }
                
                const finalX = baseX + offsetX;
                const finalY = baseY + offsetY;
                const finalZ = baseZ + offsetZ;
                
                cube.style.transform = `translate3d(${finalX}px, ${finalY}px, ${finalZ}px)`;
            });
        }

        // æ›´æ–°æ•´ä½“æ—‹è½¬
        function updateRotation() {
            cubeSystem.style.transform = `scale(${scaleFactor}) rotateX(${rotationX}deg) rotateY(${rotationY}deg)`;
        }

        // è‡ªé€‚åº”ç¼©æ”¾ä»¥é€‚é…å°å±
        function updateScale() {
            const minDim = Math.min(window.innerWidth, window.innerHeight);
            const baseSize = 230; // åŸºç¡€æ£‹ç›˜å°ºå¯¸ï¼ˆè¿‘ä¼¼ï¼‰
            const targetSize = minDim * 0.8;
            const s = targetSize / baseSize;
            scaleFactor = Math.max(0.6, Math.min(1.6, s));
            updateRotation();
        }

        // é¼ æ ‡äº‹ä»¶ï¼ˆæ—‹è½¬ï¼‰- åœ¨æ•´ä¸ªå®¹å™¨ä¸Šç›‘å¬
        container.addEventListener('mousedown', (e) => {
            // å¦‚æœç‚¹å‡»çš„æ˜¯UIå…ƒç´ ï¼Œä¸å¤„ç†æ—‹è½¬
            if (e.target.closest('.game-info') || e.target.closest('.controls')) {
                return;
            }
            
            isMouseDown = true;
            mouseX = e.clientX;
            mouseY = e.clientY;
            currentRotationX = rotationX;
            currentRotationY = rotationY;
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isMouseDown) return;

            const deltaX = e.clientX - mouseX;
            const deltaY = e.clientY - mouseY;

            rotationY = currentRotationY + deltaX * 0.5;
            rotationX = currentRotationX - deltaY * 0.5;

            rotationX = Math.max(-90, Math.min(90, rotationX));

            updateRotation();
        });

        document.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        // é”®ç›˜äº‹ä»¶
        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            
            switch(key) {
                case 'a':
                    explodeState.z = !explodeState.z;
                    updateCubePositions();
                    break;
                case 's':
                    explodeState.y = !explodeState.y;
                    updateCubePositions();
                    break;
                case 'd':
                    explodeState.x = !explodeState.x;
                    updateCubePositions();
                    break;
                case 'z':
                    if (e.ctrlKey) {
                        e.preventDefault();
                        undoMove();
                    }
                    break;
            }
        });

        // è§¦æ‘¸äº‹ä»¶ï¼ˆæ—‹è½¬ï¼‰
        function handleTouchStart(e) {
            if (e.target.closest('.game-info') || e.target.closest('.controls')) {
                return;
            }
            isMouseDown = true;
            const touch = e.touches[0];
            mouseX = touch.clientX;
            mouseY = touch.clientY;
            currentRotationX = rotationX;
            currentRotationY = rotationY;
            e.preventDefault();
        }

        function handleTouchMove(e) {
            if (!isMouseDown) return;
            const touch = e.touches[0];
            const deltaX = touch.clientX - mouseX;
            const deltaY = touch.clientY - mouseY;
            rotationY = currentRotationY + deltaX * 0.5;
            rotationX = currentRotationX - deltaY * 0.5;
            rotationX = Math.max(-90, Math.min(90, rotationX));
            updateRotation();
            e.preventDefault();
        }

        function handleTouchEnd() {
            isMouseDown = false;
        }

        container.addEventListener('touchstart', handleTouchStart, { passive: false });
        document.addEventListener('touchmove', handleTouchMove, { passive: false });
        document.addEventListener('touchend', handleTouchEnd);

        // åˆå§‹åŒ–
        createCubes();
        updateScale();
        updateRotation();
        updateUI();

        // ç›‘å¬çª—å£å˜åŒ–
        window.addEventListener('resize', updateScale);
        window.addEventListener('orientationchange', updateScale);
    </script>
</body>
</html>
