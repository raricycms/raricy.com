<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>21 点 · 人机对战</title>
  <style>
    :root{
      --bg:#0a0f14;             /* 背景 */
      --panel:#101820;           /* 面板 */
      --panel-2:#0f1520;
      --accent:#14b8a6;          /* 青色 */
      --accent-2:#8b5cf6;        /* 紫色 */
      --danger:#ef4444;          /* 红 */
      --ok:#22c55e;              /* 绿 */
      --text:#e5e7eb;            /* 文本 */
      --muted:#9ca3af;           /* 次要文本 */
      --gold:#f59e0b;            /* 金色 */
      --chip:#1f2937;            /* 筹码底色 */
      --card:#f8fafc;            /* 纸牌白 */
      --shadow: 0 10px 30px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.3);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text); background:
        radial-gradient(1200px 600px at -10% -20%, rgba(20,184,166,.15), transparent 60%),
        radial-gradient(1200px 600px at 110% -10%, rgba(139,92,246,.15), transparent 60%),
        var(--bg);
      overflow-x:hidden;
    }
    .container{max-width:1100px;margin:0 auto;padding:16px 16px 28px}

    header{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:14px 16px; background:linear-gradient(180deg,var(--panel),var(--panel-2));
      border:1px solid rgba(255,255,255,.06); border-radius:var(--radius);
      box-shadow:var(--shadow);
      position:sticky; top:8px; z-index:5;
      backdrop-filter:saturate(1.2) blur(4px);
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:36px;height:36px;border-radius:12px; background:
      conic-gradient(from 210deg,var(--accent),var(--accent-2));
      position:relative; box-shadow:0 6px 18px rgba(20,184,166,.35);
    }
    .logo::after{content:"♠";position:absolute;inset:0;display:grid;place-items:center;font-size:20px;color:#fff;filter:drop-shadow(0 2px 2px rgba(0,0,0,.4))}
    .title{font-weight:800; letter-spacing:.3px}
    .subtitle{font-size:12px;color:var(--muted)}

    .stats{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .pill{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#0b1220;border:1px solid rgba(255,255,255,.06)}
    .dot{width:8px;height:8px;border-radius:50%}

    .main{
      margin-top:14px; display:grid; grid-template-columns: 1.1fr 0.9fr; gap:14px;
    }
    @media (max-width: 920px){.main{grid-template-columns: 1fr;}}

    .table{
      background: radial-gradient(120% 140% at 50% -20%, rgba(20,184,166,.08), transparent 45%),
                 linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0) 15%),
                 #0c1515;
      border:1px solid rgba(255,255,255,.06);
      border-radius:var(--radius);
      padding:14px; box-shadow:var(--shadow);
      min-height:450px; position:relative; overflow:hidden;
    }
    .felt{position:absolute; inset:14px; border-radius:16px; outline:1px dashed rgba(255,255,255,.06); pointer-events:none}
    .area{display:grid; gap:10px}

    .row{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;min-height:120px;padding:8px}

    .label{font-size:12px;color:var(--muted); text-align:center}

    .hand{display:flex; gap:12px; align-items:center; position:relative}
    .score{position:absolute; top:-10px; left:-8px; padding:4px 10px; border-radius:999px; background:#0b1220; border:1px solid rgba(255,255,255,.08); font-size:12px}

    .card{
      width:72px;height:104px;border-radius:12px;background:var(--card);
      border:1px solid rgba(0,0,0,.1); box-shadow:0 12px 20px rgba(0,0,0,.25);
      position:relative; transform:translateY(-10px) rotate(-1deg);
      transition: transform .35s cubic-bezier(.2,.8,.2,1), box-shadow .35s;
      user-select:none;
    }
    .card.dealing{transform: translateY(-26px) rotate(-8deg);}
    .card:hover{transform: translateY(-14px) rotate(-2deg);}

    .front, .back{position:absolute; inset:0; border-radius:12px; display:grid;place-items:center; backface-visibility:hidden; transition:transform .5s}
    .front{background:var(--card)}
    .back{background:conic-gradient(from 120deg, var(--accent), var(--accent-2)); transform:rotateY(180deg); color:white; font-size:22px;}
    .card.flipped .front{transform:rotateY(180deg)}
    .card.flipped .back{transform:rotateY(0)}

    .rank{position:absolute; top:8px; left:8px; font-weight:700}
    .suit{font-size:24px}
    .corner{position:absolute; bottom:8px; right:8px; transform:rotate(180deg); font-weight:700}
    .red{color:#ef4444}
    .black{color:#111827}

    .panel{
      background:linear-gradient(180deg,var(--panel),var(--panel-2)); padding:14px; border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.06); box-shadow:var(--shadow);
    }

    .controls{display:grid; gap:10px}

    .buttons{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px}
    .btn{
      padding:14px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.08);
      background:#0b1220; color:var(--text); font-weight:700; letter-spacing:.3px;
      box-shadow:0 6px 14px rgba(0,0,0,.25); cursor:pointer; touch-action:manipulation;
      transition: transform .06s ease, background .2s, border-color .2s;
      user-select:none;
    }
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(180deg, rgba(20,184,166,.24), rgba(20,184,166,.12)); border-color:rgba(20,184,166,.35)}
    .btn.warning{background:linear-gradient(180deg, rgba(245,158,11,.24), rgba(245,158,11,.12)); border-color:rgba(245,158,11,.35)}
    .btn.danger{background:linear-gradient(180deg, rgba(239,68,68,.24), rgba(239,68,68,.12)); border-color:rgba(239,68,68,.35)}
    .btn.disabled{opacity:.45; pointer-events:none; filter:grayscale(.3)}

    .chips{display:flex;flex-wrap:wrap;gap:10px}
    .chip{min-width:64px; padding:10px 12px; border-radius:999px;background:radial-gradient(120% 100% at 50% -20%, rgba(255,255,255,.12), transparent 40%), var(--chip); border:1px solid rgba(255,255,255,.09); box-shadow:0 8px 14px rgba(0,0,0,.25); cursor:pointer; display:flex; align-items:center; gap:8px; font-weight:700}
    .chip .c{width:22px;height:22px;border-radius:50%;background:conic-gradient(from 120deg,var(--gold),#fff0); box-shadow: inset 0 0 0 3px rgba(245,158,11,.35), 0 2px 6px rgba(0,0,0,.35)}

    .betline{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .amount{padding:10px 12px;border-radius:10px;background:#0b1220;border:1px solid rgba(255,255,255,.08)}

    .msg{min-height:24px; color:var(--gold); font-weight:700; text-align:center; letter-spacing:.4px}
    .muted{color:var(--muted)}

    .footer{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:10px;color:var(--muted);font-size:12px}

    .ribbon{position:absolute;right:-50px;top:14px;transform:rotate(35deg);background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;padding:6px 60px;border-radius:999px;box-shadow:var(--shadow);font-weight:800;letter-spacing:.5px}

    .confetti{pointer-events:none; position:absolute; inset:0; overflow:hidden}
    .piece{position:absolute; width:10px; height:14px; opacity:0; animation: fall 2.6s ease-in forwards}
    @keyframes fall{0%{transform:translateY(-20vh) rotate(0); opacity:0} 10%{opacity:1} 100%{transform:translateY(120vh) rotate(540deg); opacity:0}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">21 点 · 人机对战</div>
          <div class="subtitle">起始筹码 100 ｜ 达到 1000 获胜 · 破产失败（可本地存档）</div>
        </div>
      </div>
      <div class="stats">
        <div class="pill"><span class="dot" style="background:var(--accent)"></span><span>余额：<b id="bank">--</b></span></div>
        <div class="pill"><span class="dot" style="background:var(--gold)"></span><span>本局下注：<b id="bet">0</b></span></div>
        <div class="pill"><span class="dot" style="background:var(--accent-2)"></span><span>靶分：1000</span></div>
      </div>
    </header>

    <div class="main">
      <!-- 牌桌 -->
      <section class="table" id="table">
        <div class="ribbon" id="ribbon" style="display:none">连胜中</div>
        <div class="felt" aria-hidden="true"></div>
        <div class="area">
          <div class="row">
            <div>
              <div class="label">庄家（≥17 停牌）</div>
              <div class="hand" id="dealer"></div>
            </div>
          </div>
          <div class="row" style="min-height:38px">
            <div class="msg" id="message"></div>
          </div>
          <div class="row">
            <div>
              <div class="label">玩家</div>
              <div class="hand" id="player"></div>
            </div>
          </div>
        </div>
        <div class="confetti" id="confetti"></div>
      </section>

      <!-- 侧边操作与下注 -->
      <aside class="panel controls">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
          <div>
            <div class="label">下注（点筹码或输入）</div>
            <div class="betline">
              <div class="chips">
                <button class="chip" data-chip="5"><span class="c"></span> +5</button>
                <button class="chip" data-chip="10"><span class="c"></span> +10</button>
                <button class="chip" data-chip="25"><span class="c"></span> +25</button>
                <button class="chip" data-chip="50"><span class="c"></span> +50</button>
                <button class="chip" data-chip="100"><span class="c"></span> +100</button>
              </div>
            </div>
          </div>
          <div>
            <div class="label">当前下注</div>
            <input id="betInput" class="amount" type="number" min="0" step="5" value="0" inputmode="numeric" pattern="[0-9]*" style="width:120px" />
            <div class="label muted">不可超过余额</div>
          </div>
        </div>

        <div class="buttons">
          <button class="btn primary" id="dealBtn">发牌</button>
          <button class="btn" id="hitBtn" disabled>要牌</button>
          <button class="btn" id="standBtn" disabled>停牌</button>
          <button class="btn warning" id="doubleBtn" disabled>加倍</button>
          <button class="btn" id="newRoundBtn" disabled>新一局</button>
          <button class="btn danger" id="resetBtn">重置存档</button>
        </div>

        <div class="panel" style="background:#0b1220; border-radius:14px">
          <div style="font-weight:800; letter-spacing:.3px; margin-bottom:6px">规则速览</div>
          <ul style="margin:0; padding-left:18px; line-height:1.7; color:var(--muted)">
            <li>初始 100，达到 1000 获胜；归零失败（本地存档，可刷新后继续）。</li>
            <li>每局先下注再 <b>发牌</b>；黑杰克（A + 10点）按 <b>3:2</b> 赔付。</li>
            <li>庄家在 <b>所有 17</b> 停牌；玩家可 <b>加倍</b>（仅首两张且余额足够）。</li>
          </ul>
        </div>
      </aside>
    </div>

    <div class="footer">
      <div>© 2025 轻量版 21 点 · 纯前端单文件 · 手机友好</div>
      <div>小技巧：双击筹码快速叠加；长按“发牌”= 全押。</div>
    </div>
  </div>

  <script>
    // —— 工具 ——
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    // —— 游戏状态 ——
    const TARGET = 1000;
    const STORAGE_KEY = 'bj_balance_v1';
    const STORAGE_STREAK = 'bj_streak_v1';

    let bank = Number(localStorage.getItem(STORAGE_KEY) || 100);
    let winStreak = Number(localStorage.getItem(STORAGE_STREAK) || 0);

    let deck = [];
    let playerHand = [];
    let dealerHand = [];
    let bet = 0;
    let inRound = false;
    let playerTurn = false;
    let doubled = false;

    // —— UI 引用 ——
    const bankEl = $('#bank');
    const betEl = $('#bet');
    const betInput = $('#betInput');
    const msg = $('#message');
    const dealerEl = $('#dealer');
    const playerEl = $('#player');
    const dealBtn = $('#dealBtn');
    const hitBtn = $('#hitBtn');
    const standBtn = $('#standBtn');
    const doubleBtn = $('#doubleBtn');
    const newRoundBtn = $('#newRoundBtn');
    const resetBtn = $('#resetBtn');
    const confettiEl = $('#confetti');
    const ribbonEl = $('#ribbon');

    function save(){ localStorage.setItem(STORAGE_KEY, bank); localStorage.setItem(STORAGE_STREAK, winStreak) }

    // —— 牌堆：使用 4 副牌 ——
    function buildDeck(){
      const suits = ['♠','♥','♦','♣'];
      const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
      deck = [];
      for(let d=0; d<4; d++){
        for(const s of suits){
          for(const r of ranks){ deck.push({suit:s, rank:r}); }
        }
      }
      // 洗牌（Fisher–Yates）
      for(let i=deck.length-1;i>0;i--){
        const j = (Math.random()* (i+1))|0; [deck[i], deck[j]] = [deck[j], deck[i]];
      }
    }

    function cardValue(card){
      if(card.rank==='A') return 11;  // 先按 11 算，稍后软处理
      if(['K','Q','J'].includes(card.rank)) return 10;
      return Number(card.rank);
    }

    function calcScore(hand){
      let total = 0; let aces = 0;
      for(const c of hand){
        total += cardValue(c);
        if(c.rank==='A') aces++;
      }
      while(total>21 && aces>0){ total -= 10; aces--; } // 软 A -> 1
      return total;
    }

    function isBlackjack(hand){ return hand.length===2 && calcScore(hand)===21 }

    function updateRibbon(){ ribbonEl.style.display = winStreak>=2 ? 'block' : 'none' }

    function updateUI(){
      bankEl.textContent = bank;
      betEl.textContent = bet;
      betInput.max = bank; // 避免超过余额
      updateRibbon();
    }

    function clearHands(){ playerHand = []; dealerHand = []; playerEl.innerHTML=''; dealerEl.innerHTML=''; }

    function createCardEl(card, hidden=false){
      const div = document.createElement('div');
      div.className = 'card' + (hidden ? ' flipped' : '');
      const front = document.createElement('div'); front.className='front';
      const back = document.createElement('div'); back.className='back'; back.textContent='◆◆';

      const rankTop = document.createElement('div'); rankTop.className='rank'; rankTop.textContent=card.rank;
      const suit = document.createElement('div'); suit.className='suit'; suit.textContent=card.suit;
      const rankBot = document.createElement('div'); rankBot.className='corner'; rankBot.textContent=card.rank;

      const red = (card.suit==='♥' || card.suit==='♦');
      rankTop.classList.add(red?'red':'black');
      rankBot.classList.add(red?'red':'black');
      suit.classList.add(red?'red':'black');

      front.appendChild(rankTop); front.appendChild(suit); front.appendChild(rankBot);
      div.appendChild(front); div.appendChild(back);

      // 分数徽章
      div.setScore = (score, show=false) => {
        if(!div._badge){ const b=document.createElement('div'); b.className='score'; div._badge=b; div.appendChild(b) }
        div._badge.textContent = show? score : '';
      }

      // 动画
      setTimeout(()=>div.classList.add('dealing'), 10);
      setTimeout(()=>div.classList.remove('dealing'), 380);

      return div;
    }

    function renderHands(revealDealer=false){
      dealerEl.innerHTML=''; playerEl.innerHTML='';
      dealerHand.forEach((c, i)=>{
        const hidden = (i===1 && !revealDealer && inRound); // 庄家第二张盖住
        const el = createCardEl(c, hidden);
        dealerEl.appendChild(el);
      });
      playerHand.forEach(c=>{ playerEl.appendChild(createCardEl(c, false)); });

      // 更新分数徽章
      const pScore = calcScore(playerHand);
      const dScore = calcScore(dealerHand);
      $$('#player .card').forEach(el=> el.setScore && el.setScore(pScore, true));
      $$('#dealer .card').forEach((el,i)=> el.setScore && el.setScore(i===1 && !revealDealer && inRound ? '' : dScore, revealDealer || !inRound));
    }

    function setMessage(text, tone='info'){
      msg.textContent = text;
      msg.style.color = tone==='win' ? 'var(--ok)' : tone==='lose' ? 'var(--danger)' : tone==='gold' ? 'var(--gold)' : 'var(--gold)';
    }

    function enableActions({deal=true, hit=false, stand=false, double=false, newRound=false}){
      toggleBtn(dealBtn, deal);
      toggleBtn(hitBtn, hit);
      toggleBtn(standBtn, stand);
      toggleBtn(doubleBtn, double);
      toggleBtn(newRoundBtn, newRound);
    }
    function toggleBtn(btn, enabled){ btn.disabled = !enabled; btn.classList.toggle('disabled', !enabled) }

    function bustFlash(targetEl){
      targetEl.style.filter='drop-shadow(0 0 10px rgba(239,68,68,.8))';
      setTimeout(()=>targetEl.style.filter='', 500);
    }

    function confetti(){
      confettiEl.innerHTML='';
      const n = 80 + Math.floor(Math.random()*40);
      for(let i=0;i<n;i++){
        const p = document.createElement('div'); p.className='piece';
        p.style.left = Math.random()*100+'%';
        p.style.top = '-10%';
        p.style.background = `hsl(${(Math.random()*360)|0} 90% 60%)`;
        p.style.animationDelay = (Math.random()*0.7)+'s';
        p.style.transform = `translateY(-10vh) rotate(${Math.random()*180}deg)`;
        confettiEl.appendChild(p);
      }
      setTimeout(()=> confettiEl.innerHTML='', 3000);
    }

    function checkGoal(){
      if(bank >= TARGET){
        setMessage(`恭喜！已达 ${TARGET}，你赢下整个挑战！`, 'win');
        confetti();
        enableActions({deal:false, newRound:true});
      } else if(bank <= 0){
        setMessage('破产啦……点“重置存档”重新开始', 'lose');
        enableActions({deal:false});
      }
    }

    // —— 流程 ——
    function startRound(){
      if(inRound) return;
      bet = clampBet(Number(betInput.value||0));
      if(bet<=0) { setMessage('请先下注再发牌。'); return }
      if(bet>bank){ setMessage('下注不能超过余额。'); return }

      inRound = true; playerTurn = true; doubled = false;
      bank -= bet; updateUI(); save();
      setMessage('祝你好运！');

      clearHands();
      if(deck.length < 30) buildDeck();

      // 发四张：玩家、庄家（明）、玩家、庄家（暗）
      playerHand.push(deck.pop());
      dealerHand.push(deck.pop());
      playerHand.push(deck.pop());
      dealerHand.push(deck.pop());
      renderHands(false);

      // 黑杰克判定
      if(isBlackjack(playerHand) || isBlackjack(dealerHand)){
        settle(true);
        return;
      }

      enableActions({deal:false, hit:true, stand:true, double:true});
    }

    function playerHit(){
      if(!inRound || !playerTurn) return;
      playerHand.push(deck.pop());
      renderHands(false);
      const p = calcScore(playerHand);
      if(p>21){
        setMessage('爆了！这局输。', 'lose');
        bustFlash(playerEl);
        playerTurn = false; inRound = false; winStreak = 0; save();
        enableActions({newRound:true});
        checkGoal();
      } else {
        doubleBtn.disabled = true; doubleBtn.classList.add('disabled');
      }
    }

    function playerStand(){
      if(!inRound || !playerTurn) return;
      playerTurn = false;
      dealerPlay();
    }

    function playerDouble(){
      if(!inRound || !playerTurn) return;
      if(playerHand.length!==2){ setMessage('只有首两张时可以加倍'); return }
      if(bank < bet){ setMessage('余额不足以加倍'); return }
      bank -= bet; bet *= 2; doubled = true; updateUI(); save();
      playerHit(); // 发一张
      if(inRound){ // 如果没爆，立即停牌
        playerStand();
      }
    }

    function dealerPlay(){
      enableActions({});
      // 翻开盖牌
      renderHands(true);

      // 庄家 ≥17 停牌（包含软17）
      while(calcScore(dealerHand) < 17){
        dealerHand.push(deck.pop());
        renderHands(true);
      }
      settle(false);
    }

    function settle(immediate){
      const p = calcScore(playerHand);
      const d = calcScore(dealerHand);
      const playerBJ = isBlackjack(playerHand);
      const dealerBJ = isBlackjack(dealerHand);

      let outcome = '';
      let payout = 0;

      if(immediate){
        if(playerBJ && dealerBJ){ outcome='和局（双方黑杰克）'; payout = bet; }
        else if(playerBJ){ outcome='黑杰克！3:2 赔付'; payout = bet + Math.floor(bet*2.5); winStreak++; }
        else if(dealerBJ){ outcome='庄家黑杰克，你输啦'; payout = 0; winStreak=0; }
      } else {
        const pBust = p>21, dBust = d>21;
        if(pBust && dBust){ outcome='都爆了？按平局处理'; payout = bet; winStreak=0; }
        else if(pBust){ outcome='你爆了，这局输'; payout=0; winStreak=0; }
        else if(dBust){ outcome='庄家爆了，你赢！'; payout=bet*2; winStreak++; }
        else if(p>d){ outcome='你赢了！'; payout=bet*2; winStreak++; }
        else if(p<d){ outcome='你输了…'; payout=0; winStreak=0; }
        else { outcome='平局，退还下注'; payout=bet; }
      }

      bank += payout; inRound=false; playerTurn=false; updateUI(); save();
      renderHands(true);

      if(payout>0 && outcome.includes('赢')) confetti();

      setMessage(outcome + `（点“新一局”继续）`, outcome.includes('赢')? 'win' : outcome.includes('输')? 'lose' : 'gold');
      enableActions({newRound:true});
      checkGoal();
    }

    function newRound(){
      bet = 0; betInput.value=0; updateUI();
      clearHands(); setMessage('下注后点击“发牌”。');
      enableActions({deal:true});
    }

    function resetAll(){
      bank = 100; bet = 0; winStreak = 0; save(); updateUI(); newRound(); setMessage('已重置。好运～');
    }

    function clampBet(v){ v = Math.max(0, Math.floor(v)); return Math.min(v, bank) }

    // —— 事件 ——
    $$('.chip').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const add = Number(btn.dataset.chip);
        bet = clampBet((bet||0) + add);
        betInput.value = bet; betEl.textContent = bet;
      });
      // 双击快速叠加
      btn.addEventListener('dblclick', ()=>{
        const add = Number(btn.dataset.chip)*2;
        bet = clampBet((bet||0)+add); betInput.value=bet; betEl.textContent=bet;
      }, {passive:true});
    });

    betInput.addEventListener('input', ()=>{ bet = clampBet(Number(betInput.value||0)); betInput.value=bet; betEl.textContent=bet });

    dealBtn.addEventListener('click', startRound);
    // 长按全押
    let pressTimer=null;
    dealBtn.addEventListener('touchstart', (e)=>{ pressTimer=setTimeout(()=>{ if(!inRound){ bet=bank; betInput.value=bet; betEl.textContent=bet; setMessage('已全押！现在点“发牌”'); } }, 450)}, {passive:true});
    dealBtn.addEventListener('touchend', ()=> clearTimeout(pressTimer));
    dealBtn.addEventListener('mousedown', ()=>{ pressTimer=setTimeout(()=>{ if(!inRound){ bet=bank; betInput.value=bet; betEl.textContent=bet; setMessage('已全押！现在点“发牌”'); } }, 600)});
    dealBtn.addEventListener('mouseup', ()=> clearTimeout(pressTimer));

    hitBtn.addEventListener('click', playerHit);
    standBtn.addEventListener('click', playerStand);
    doubleBtn.addEventListener('click', playerDouble);
    newRoundBtn.addEventListener('click', newRound);
    resetBtn.addEventListener('click', resetAll);

    // 键盘快捷键
    window.addEventListener('keydown', (e)=>{
      if(e.repeat) return;
      if(e.key==='h' || e.key==='H') hitBtn.click();
      if(e.key==='s' || e.key==='S') standBtn.click();
      if(e.key==='d' || e.key==='D') doubleBtn.click();
      if(e.key==='Enter') dealBtn.click();
    });

    // 初始
    buildDeck();
    updateUI();
    setMessage('下注后点击“发牌”。');
    enableActions({deal:true});
    checkGoal();
  </script>
</body>
</html>
